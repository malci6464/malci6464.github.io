<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/parallel-coordinates.js"></script>

    <title>BOOKS</title>
  </head>
  <body>
    <div
      class="button-layout"
      id="btn-group"
      style="display: flex; align-items: center; flex-direction: row"
    >
      <!-- <div style="padding: 12px">
        <p>Genre:</p>
        <select class="form-control" id="genre" onchange="removeGenre(value)">
          <option value="default">-- All genres --</option>
        </select>
        <br />
      </div>
      <div style="padding: 12px">
        <p>Author:</p>
        <select class="form-control" id="author" onchange="yearSelect(value)">
          <option value="default">-- All authors --</option>
        </select>
        <br />
      </div> -->
    </div>
    <!-- <div style="padding: 12px;">
        <p>Books:</p>
        <select class="form-control" id="quart" onchange="quartSelect(value)">
            <option value="default">-- All Books --</option>
        </select>
        <br>
    </div> -->
    <figure class="highcharts-figure">
        <div id="container"></div>
        <div id="container1"></div>
    <p class="highcharts-description">
     Hover over the chart to reveal information about each book.
    </p>
</figure>


    <script>
      //         fetch('./t2.json')
      //   .then(response => response.json())
      //   .then(data => console.log(data));

      let genre = [];
      let author = [];
      let book = [];
      let textDF = []
      let currentDF = []

      let zr = []
      let one = []

      function mapper(df) {
        let newDF = [];
        df.map((each) => newDF.push(lookup(each)));
        return newDF;
      }

      function lookup(datapoint) {
        if (genre.indexOf(datapoint.Genre) === -1) {
          genre.push(datapoint.Genre);
        }
        if (author.indexOf(datapoint.Author) === -1) {
          author.push(datapoint.Author);
        }
        if (book.indexOf(datapoint.Name) === -1) {
          book.push(datapoint.Name);
        }

        //textDF.push([datapoint.Genre,datapoint.Author, datapoint.Name])

        let gen1 = genre.indexOf(datapoint.Genre);
        let gen2 = author.indexOf(datapoint.Author);
        let gen3 = book.indexOf(datapoint.Name);
        let gen4 = {
            rating : datapoint['User Rating'],
            price : datapoint.Price,
            year:  datapoint.Year,
            reviews: datapoint.Reviews,
            name: datapoint.Name,
            author: datapoint.Author

        }

        let d1 = [gen1, gen2, gen3, gen4]
        if (d1[0] === 0){
                zr.push(d1)
        }
        else{
            one.push(d1)
        }
      }

     

      function selectAuthor() {}

      Highcharts.getJSON("./t2.json", function (data) {
        currentDF = mapper(data);
        //console.log(newdf);

        // // build dropdown - genre
        // var g1 = document.getElementById("genre");
        // for (var i = 0; i < genre.length; i++) {
        //   var optn = genre[i];
        //   var el = document.createElement("option");
        //   el.textContent = optn;
        //   el.value = optn;
        //   g1.appendChild(el);
        // }

        // // build dropdown - genre
        // var g2 = document.getElementById("author");
        // for (var i = 0; i < author.length; i++) {
        //   var optn = author[i];
        //   var el = document.createElement("option");
        //   el.textContent = optn;
        //   el.value = optn;
        //   g2.appendChild(el);
        // }

       

        let chart = Highcharts.chart("container", {
          chart: {
            type: "spline",
            parallelCoordinates: true,
            parallelAxes: {
              lineWidth: 2,
            },
          },
          title: {
            text: "Amazon Bookshelf",
          },
          subtitle:{
              text: 'Non Fiction'
          },
          plotOptions: {
            series: {
              animation: false,
              marker: {
                enabled: false,
                states: {
                  hover: {
                    enabled: false,
                  },
                },
              },
              states: {
                hover: {
                  halo: {
                    size: 0,
                  },
                },
              },
            },
          },
          legend: {
              enabled: false,
          },
          credits:{
              enabled: false,
          },
          xAxis: {
            startOnTick: true,
            categories: ["Genre", "Author ", "Book"],
          },
          yAxis: [
            {
              type: "category",
              startOnTick: true,
              min: 0,
              max: 0,
              categories: genre,
            },

            {
              type: "category",
              startOnTick: true,
                 min: 0,
                 max: 246,
              categories: author,
            },
            {
              type: "category",
              startOnTick: true,
                 min: 0,
                 max: 350,
              categories: book,
            },
          ],
          colors: ['rgba(11, 200, 200, 0.1)'],

          series: zr.map(function (set, i) {
            return {
                name: set[3].name + '<br> (' + set[3].author + ', ' +  set[3].year  +  ') <br> ' + 'Price: $' +set[3].price + '<br>Reviews: ' +set[3].reviews ,
              data: [set[0], set[1], set[2]],
              shadow: false,
    //           tooltip: {
    //     useHTML: true,
    //     headerFormat: '<table><tr><th colspan="2">{point.key}</th></tr>',
    //     pointFormat: '<tr><td style="color: {series.color}">{series.name} </td>' +
    //         '<td style="text-align: right"><b>{point.y} EUR</b></td></tr>',
    //     footerFormat: '</table>',
    //     valueDecimals: 2
    // },


            };
          }),
        });

        let chart1 = Highcharts.chart("container1", {
          chart: {
            type: "spline",
            parallelCoordinates: true,
            parallelAxes: {
              lineWidth: 2,
            },
          },
          title: {
            text: null,
          },
          subtitle:{
              text: 'Fiction'
          },
          plotOptions: {
            series: {
              animation: false,
              marker: {
                enabled: false,
                states: {
                  hover: {
                    enabled: false,
                  },
                },
              },
              states: {
                hover: {
                  halo: {
                    size: 0,
                  },
                },
              },
            },
          },
          legend: {
              enabled: false,
          },
          credits:{
              enabled: false,
          },
          xAxis: {
            startOnTick: true,
            categories: ["Genre", "Author ", "Book"],
          },
          yAxis: [
            {
              type: "category",
              startOnTick: true,
              min: 1,
              max: 1,
              categories: genre,
            },

            {
              type: "category",
              startOnTick: true,
                 min: 0,
                 max: 246,
              categories: author,
            },
            {
              type: "category",
              startOnTick: true,
                 min: 0,
                 max: 350,
              categories: book,
            },
          ],
          colors: ['rgba(11, 200, 200, 0.1)'],

          series: one.map(function (set, i) {
            return {
                name: set[3].name + '<br> (' + set[3].author + ', ' +  set[3].year  +  ') <br> ' + 'Price: $' +set[3].price + '<br>Reviews: ' +set[3].reviews ,
              data: [set[0], set[1], set[2]],
              shadow: false,
    //           tooltip: {
    //     useHTML: true,
    //     headerFormat: '<table><tr><th colspan="2">{point.key}</th></tr>',
    //     pointFormat: '<tr><td style="color: {series.color}">{series.name} </td>' +
    //         '<td style="text-align: right"><b>{point.y} EUR</b></td></tr>',
    //     footerFormat: '</table>',
    //     valueDecimals: 2
    // },


            };
          }),
        });
      });

      function removeGenre(value){
        let val ={
            'Non Fiction' : 0,
            'Fiction' : 1
        }
       let newdf =  currentDF.filter(each => each[0] === val[value])
       console.log(newdf)
       let dff = newdf.map(function (set, i) {
            return {
              name: set[3].name,
              data: [set[0], set[1], set[2]],
              shadow: false,
            };
          })
          var gchart = document.getElementById("container");
       gchart.series[0].update({
        dff
    }, false, false, false);
       return newdf
      }

    </script>
  </body>
  <style>
    #container {
      display: flex;
      flex-direction: column;
      width: 100%;
      min-height: 1200px;
      overflow: scroll;
    }

    #container-int {
      width: 100%;
      margin: 0 auto;
      padding: 12px;
      height: 65%;
    }

    #container-bar {
      width: 95%;

      margin: 0 auto;
    }
    .highcharts-series-hover path {
    stroke: rgb(255 66 66);
    stroke-width: 2px;
}
  </style>
</html>
