<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/parallel-coordinates.js"></script>

    <title>BOOKS</title>
  </head>
  <body>
    <p>** Refresh the page to reset the filters</p>
    <div
      class="button-layout"
      id="btn-group"
      style="display: flex; align-items: center; flex-direction: row"
    >
      <div style="padding: 12px">
        <p>Genre:</p>
        <select class="form-control" id="genre" onchange="removeGenre(value)">
          <option value="default">-- All genres --</option>
        </select>
        <br />
      </div>
      <div style="padding: 12px">
        <p>Author:</p>
        <select class="form-control" id="author" onchange="yearSelect(value)">
          <option value="default">-- All authors --</option>
        </select>
        <br />
      </div>
    </div>
    <!-- <div style="padding: 12px;">
        <p>Books:</p>
        <select class="form-control" id="quart" onchange="quartSelect(value)">
            <option value="default">-- All Books --</option>
        </select>
        <br>
    </div> -->
    <figure class="highcharts-figure">
        <div id="container"></div>
    <p class="highcharts-description">
      Chart showing an example of a parallel coordinate plot. This type of
      visualization is commonly used to show multivariate data, and can help
      analyze large datasets to find patterns and correlations.
    </p>
</figure>


    <script>
      //         fetch('./t2.json')
      //   .then(response => response.json())
      //   .then(data => console.log(data));

      let genre = [];
      let author = [];
      let book = [];
      let textDF = []
      let currentDF = []

      function mapper(df) {
        let newDF = [];
        df.map((each) => newDF.push(lookup(each)));
        return newDF;
      }

      function lookup(datapoint) {
        if (genre.indexOf(datapoint.Genre) === -1) {
          genre.push(datapoint.Genre);
        }
        if (author.indexOf(datapoint.Author) === -1) {
          author.push(datapoint.Author);
        }
        if (book.indexOf(datapoint.Name) === -1) {
          book.push(datapoint.Name);
        }

        textDF.push([datapoint.Genre,datapoint.Author, datapoint.Name])

        let gen1 = genre.indexOf(datapoint.Genre);
        let gen2 = author.indexOf(datapoint.Author);
        let gen3 = book.indexOf(datapoint.Name);
        return [gen1, gen2, gen3];
      }

     

      function selectAuthor() {}

      Highcharts.getJSON("./t2.json", function (data) {
        currentDF = mapper(data);
        //console.log(newdf);

        // build dropdown - genre
        var g1 = document.getElementById("genre");
        for (var i = 0; i < genre.length; i++) {
          var optn = genre[i];
          var el = document.createElement("option");
          el.textContent = optn;
          el.value = optn;
          g1.appendChild(el);
        }

        // build dropdown - genre
        var g2 = document.getElementById("author");
        for (var i = 0; i < author.length; i++) {
          var optn = author[i];
          var el = document.createElement("option");
          el.textContent = optn;
          el.value = optn;
          g2.appendChild(el);
        }
        let chart = Highcharts.chart("container", {
          chart: {
            type: "spline",
            parallelCoordinates: true,
            parallelAxes: {
              lineWidth: 2,
            },
          },
          title: {
            text: "grepS Version History effects",
          },
          plotOptions: {
            series: {
              animation: false,
              marker: {
                enabled: false,
                states: {
                  hover: {
                    enabled: false,
                  },
                },
              },
              states: {
                hover: {
                  halo: {
                    size: 0,
                  },
                },
              },
            },
          },
          legend: {
              enabled: true,
          },
          xAxis: {
            startOnTick: true,
            categories: ["Genre", "Author ", "Book"],
          },
          yAxis: [
            {
              type: "category",
              startOnTick: true,
              min: 0,
              max: 1,
              categories: genre,
            },

            {
              type: "category",
              startOnTick: true,
              //   min: 0,
              //   max: 600,
              categories: author,
            },
            {
              type: "category",
              startOnTick: true,
              //   min: 0,
              //   max: 600,
              categories: book,
            },
          ],

          series: currentDF.map(function (set, i) {
            return {
              name: "Runner " + i,
              data: set,
              shadow: false,
            };
          }),
        });
      });

      function removeGenre(value){
        let val ={
            'Non Fiction' : 0,
            'Fiction' : 1
        }
       let newdf =  currentDF.filter(each => each[0] === val[value])
       console.log(newdf)
       let dff = currentDF.map(function (set, i) {
            return {
              name: "Runner " + i,
              data: set,
              shadow: false,
            };
          })
       chart.series[0].update({
        dff
    }, false, false, false);
       return newdf
      }

    </script>
  </body>
  <style>
    #container {
      display: flex;
      flex-direction: column;
      width: 100%;
      min-height: 600px;
      overflow: scroll;
    }

    #container-int {
      width: 100%;
      margin: 0 auto;
      padding: 12px;
      height: 65%;
    }

    #container-bar {
      width: 95%;

      margin: 0 auto;
    }
  </style>
</html>
